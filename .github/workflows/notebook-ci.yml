# Notebook CI
#
# Validates Jupyter notebooks on push/PR.
# No Drive sync needed — Colab opens notebooks directly from GitHub:
# https://colab.research.google.com/github/ny-randriantsarafara/ny-feoko/blob/main/notebooks/ambara_colab.ipynb

name: Notebook CI

on:
  push:
    branches: [main]
    paths:
      - 'notebooks/**'
  pull_request:
    branches: [main]
    paths:
      - 'notebooks/**'
  workflow_dispatch:

jobs:
  validate:
    name: Validate & Lint
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install validation tools
        run: pip install nbformat nbqa ruff

      - name: Validate notebook JSON structure
        run: |
          python -c "
          import nbformat
          import sys
          try:
              nb = nbformat.read('notebooks/ambara_colab.ipynb', as_version=4)
              nbformat.validate(nb)
              print('✓ Notebook JSON is valid')
          except Exception as e:
              print(f'✗ Validation failed: {e}')
              sys.exit(1)
          "

      - name: Lint notebook code cells
        run: |
          nbqa ruff notebooks/ \
            --select=E,F,W \
            --ignore=E402,F401,E501 \
            --exit-zero
          # E402: module level import not at top (common in notebooks)
          # F401: imported but unused (setup cells often import for later use)
          # E501: line too long (notebooks have wider displays)
          # Using --exit-zero for now; remove to enforce strict linting
